<div class="bookmarks-page">
  <!-- Page Header -->
  <section class="page-header">
    <div class="container">
      <h1>My Bookmarks</h1>
      <p>Your saved articles for later reading</p>
    </div>
  </section>

  <!-- Bookmarks Content -->
  <section class="bookmarks-content">
    <div class="container">
      <% if (bookmarks && bookmarks.length> 0) { %>
        <div class="bookmarks-grid">
          <% bookmarks.forEach(bookmark=> { %>
            <article class="bookmark-card">
              <div class="bookmark-image">
                <img src="<%= bookmark.urlToImage || '/images/placeholder.jpg' %>" alt="<%= bookmark.title %>"
                  loading="lazy">
                <div class="bookmark-date">
                  <%= new Date(bookmark.bookmarkedAt || bookmark.publishedAt).toLocaleDateString() %>
                </div>
              </div>

              <div class="bookmark-content">
                <div class="bookmark-meta">
                  <span class="bookmark-source">
                    <%= bookmark.source.name %>
                  </span>
                </div>

                <h3 class="bookmark-title">
                  <a href="/article?url=<%= encodeURIComponent(bookmark.url) %>">
                    <%= bookmark.title %>
                  </a>
                </h3>

                <p class="bookmark-description">
                  <%= bookmark.description || 'No description available.' %>
                </p>

                <div class="bookmark-actions">
                  <a href="/article?url=<%= encodeURIComponent(bookmark.url) %>" class="read-btn">
                    Read Article
                  </a>
                  <button class="remove-bookmark-btn" data-url="<%= bookmark.url %>">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 6L6 18" />
                      <path d="M6 6l12 12" />
                    </svg>
                    Remove
                  </button>
                </div>
              </div>
            </article>
            <% }); %>
        </div>
        <% } else { %>
          <!-- Empty State -->
          <div class="empty-state">
            <div class="empty-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z" />
              </svg>
            </div>
            <h2>No bookmarks yet</h2>
            <p>Start saving articles you want to read later by clicking the bookmark icon on any article.</p>
            <a href="/" class="btn btn-primary">Browse Articles</a>
          </div>
          <% } %>
    </div>
  </section>
</div>

<script>
  // Remove bookmark functionality
  document.addEventListener('DOMContentLoaded', function () {
    const removeButtons = document.querySelectorAll('.remove-bookmark-btn');

    removeButtons.forEach(button => {
      button.addEventListener('click', async function () {
        const url = this.dataset.url;

        try {
          const response = await fetch('/bookmarks/remove', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ url })
          });

          const data = await response.json();

          if (data.success) {
            // Remove the card from DOM
            this.closest('.bookmark-card').remove();
            showToast('Bookmark removed successfully', 'success');

            // Check if no bookmarks left
            const remainingCards = document.querySelectorAll('.bookmark-card');
            if (remainingCards.length === 0) {
              location.reload(); // Reload to show empty state
            }
          } else {
            throw new Error(data.message);
          }
        } catch (error) {
          console.error('Error removing bookmark:', error);
          showToast('Failed to remove bookmark', 'error');
        }
      });
    });
  });

  function showToast(message, type) {
    if (window.showToast) {
      window.showToast(message, type);
    }
  }
</script>