<div class="search-page">
  <!-- Search Header -->
  <section class="search-header">
    <div class="container">
      <div class="search-input-container">
        <input
          type="text"
          id="searchInput"
          class="search-input-large"
          placeholder="Search for news..."
          value="<%= query || '' %>"
          autocomplete="off"
        >
        <button id="searchBtn" class="search-btn-large">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        </button>
      </div>

      <!-- Search Filters -->
      <div class="search-filters">
        <div class="filter-group">
          <label for="sortSelect">Sort by:</label>
          <select id="sortSelect" class="filter-select">
            <option value="publishedAt" <%= sortBy === 'publishedAt' ? 'selected' : '' %>>Newest</option>
            <option value="relevancy" <%= sortBy === 'relevancy' ? 'selected' : '' %>>Relevance</option>
            <option value="popularity" <%= sortBy === 'popularity' ? 'selected' : '' %>>Popularity</option>
          </select>
        </div>
      </div>
    </div>
  </section>

  <!-- Search Results -->
  <section class="search-results">
    <div class="container">
      <% if (query) { %>
        <div class="results-header">
          <h2>Search Results for "<%= query %>"</h2>
          <p class="results-count">
            <%= totalResults %> article<%= totalResults !== 1 ? 's' : '' %> found
          </p>
        </div>

        <% if (articles && articles.length > 0) { %>
        <div class="results-grid">
          <% articles.forEach(article => { %>
          <article class="result-card">
            <div class="result-image">
              <img
                src="<%= article.urlToImage || '/images/placeholder.jpg' %>"
                alt="<%= article.title %>"
                loading="lazy"
                onerror="this.src='/images/placeholder.jpg'"
              >
            </div>

            <div class="result-content">
              <div class="result-meta">
                <span class="result-source"><%= article.source.name %></span>
                <span class="result-date"><%= new Date(article.publishedAt).toLocaleDateString() %></span>
              </div>

              <h3 class="result-title">
                <a href="/article?url=<%= encodeURIComponent(article.url) %>">
                  <%= article.title %>
                </a>
              </h3>

              <p class="result-description">
                <%= article.description || 'No description available.' %>
              </p>

              <div class="result-highlights">
                <% if (article.title.toLowerCase().includes(query.toLowerCase())) { %>
                  <span class="highlight-label">Title match</span>
                <% } %>
                <% if (article.description && article.description.toLowerCase().includes(query.toLowerCase())) { %>
                  <span class="highlight-label">Content match</span>
                <% } %>
              </div>

              <div class="result-actions">
                <a href="/article?url=<%= encodeURIComponent(article.url) %>" class="read-more-btn">
                  Read More
                </a>
                <button class="bookmark-btn" data-article='<%= JSON.stringify(article) %>'>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2Z"/>
                  </svg>
                </button>
              </div>
            </div>
          </article>
          <% }); %>
        </div>

        <!-- Load More for Search -->
        <div class="load-more-container">
          <button id="loadMoreSearchBtn" class="btn btn-secondary">
            Load More Results
          </button>
        </div>
        <% } else { %>
        <!-- No Results -->
        <div class="no-results">
          <div class="no-results-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
              <line x1="13" y1="9" x2="9" y2="13"/>
            </svg>
          </div>
          <h2>No results found</h2>
          <p>Try different keywords or check your spelling.</p>
          <div class="search-suggestions">
            <h3>Popular searches:</h3>
            <div class="suggestion-tags">
              <span class="tag">COVID-19</span>
              <span class="tag">Technology</span>
              <span class="tag">Politics</span>
              <span class="tag">Sports</span>
            </div>
          </div>
        </div>
        <% } %>
      <% } else { %>
        <!-- Search Prompt -->
        <div class="search-prompt">
          <div class="prompt-icon">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0.5">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </div>
          <h2>Search for News</h2>
          <p>Enter keywords to find articles from thousands of news sources worldwide.</p>
        </div>
      <% } %>
    </div>
  </section>
</div>

<script>
  // Search functionality
  document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const sortSelect = document.getElementById('sortSelect');
    const loadMoreBtn = document.getElementById('loadMoreSearchBtn');

    // Search button click
    searchBtn.addEventListener('click', performSearch);

    // Enter key press
    searchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        performSearch();
      }
    });

    // Sort change
    sortSelect.addEventListener('change', function() {
      performSearch();
    });

    // Load more results
    if (loadMoreBtn) {
      loadMoreBtn.addEventListener('click', loadMoreResults);
    }

    // Suggestion tags
    const suggestionTags = document.querySelectorAll('.tag');
    suggestionTags.forEach(tag => {
      tag.addEventListener('click', function() {
        searchInput.value = this.textContent;
        performSearch();
      });
    });
  });

  function performSearch() {
    const query = document.getElementById('searchInput').value.trim();
    const sortBy = document.getElementById('sortSelect').value;

    if (query) {
      const params = new URLSearchParams();
      params.set('q', query);
      params.set('sortBy', sortBy);
      window.location.href = `/search?${params.toString()}`;
    }
  }

  function loadMoreResults() {
    // Implement load more functionality for search results
    showToast('Load more functionality coming soon!', 'info');
  }

  function showToast(message, type) {
    if (window.showToast) {
      window.showToast(message, type);
    }
  }
</script>